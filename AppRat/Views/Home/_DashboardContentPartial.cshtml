@model AppRat.ViewModels.AR_DashboardContentViewModel
@* @using System.Text.Json *@


@{
    var categories = ViewBag.categories;
    var dailyUsed = ViewBag.dailyUsed;
    var dailyNew = ViewBag.dailyNew;
    var dailyDemo = ViewBag.dailyDemo;
    var dailyNtu = ViewBag.dailyNtu;

    var dailyApproved = ViewBag.dailyApproved;
    var dailyDeclined = ViewBag.dailyDeclined;
    var dailySelfFinanced = ViewBag.dailySelfFinanced;
    var dailyCash = ViewBag.dailyCash;
}

<script>
    var categories = @Html.Raw(Json.Serialize(categories));
    var dailyUsedData = @Html.Raw(Json.Serialize(dailyUsed));
    var dailyNewData = @Html.Raw(Json.Serialize(dailyNew));
    var dailyDemoData = @Html.Raw(Json.Serialize(dailyDemo));
    var dailyNtuData = @Html.Raw(Json.Serialize(dailyNtu));

    var dailyApprovedData = @Html.Raw(Json.Serialize(dailyApproved));
    var dailyDeclinedData = @Html.Raw(Json.Serialize(dailyDeclined));
    var dailySelfFinancedData = @Html.Raw(Json.Serialize(dailySelfFinanced)); //not in use yet
    var dailyCashData = @Html.Raw(Json.Serialize(dailyCash)); //not in use yet
    
    // Log the variables to the console
    console.log("Categories:", categories);
    console.log("Total Used Data:", dailyUsedData);
    console.log("Total New Data:", dailyNewData);
    console.log("Total Demo Data:", dailyDemoData);
    console.log("Total Ntu Data:", dailyNtuData);

    console.log("Categories:", categories);
    console.log("Total Approved Data:", dailyApprovedData);
    console.log("Total Declined Data:", dailyDeclinedData);
    // console.log("Total Self Finance Data:", dailySelfFinance);
    // console.log("Total Cash Data:", dailyCash);
</script>

<div class="row">
    <div class="col-xl-12">
        <div class="data-panel-small">
            <h3 class="mb-3 text-center">Working Days: @Model.WorkingDaysPassed of @Model.WorkingDaysTotal</h3>
            <hr />
            <div class="progress">
                <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" style="width: @Model.WorkingDaysPercetage%">@Model.WorkingDaysPercetage%</div>
            </div>
        </div>
    </div>

    <div class="col-xl-3">
        <div class="data-panel">
            <h3 class="mb-3 text-center">Target & Projection</h3>
            <hr />
            <div class="overflow-container">
                <table class="table table-borderless table-hover">
                    <thead>
                        <tr>
                            <th> </th>
                            <th>New</th>
                            <th>Used</th>
                            <th>Total</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>Target:</td>
                            <td>@Model.AR_Targets.FirstOrDefault().New</td>
                            <td>@Model.AR_Targets.FirstOrDefault().Used</td>
                            <td>@Model.TargetTotal</td>
                        </tr>
                        <tr>
                            <td>Projected:</td>
                            <td>@Model.ProjectedNew</td>
                            <td>@Model.ProjectedUsed</td>
                            <td>@Model.ProjectedTotal</td>
                        </tr>
                        <tr>
                            <td>Daily Required:</td>
                            <td>@Model.DailyAppsRequiredNew</td>
                            <td>@Model.DailyAppsRequiredUsed</td>
                            <td>@Model.DailyAppsRequiredTotal</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="col-xl-3">
        <div class="data-panel">
            <h3 class="mb-3 text-center">Applications</h3>
            <hr />
            <div class="row">
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th> </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Total Apps:</td>
                                    <td>@Model.TotalApps</td>
                                </tr>
                                <tr>
                                    <td>Apps per day:</td>
                                    <td>@Model.AppsPerDay</td>
                                </tr>
                                <tr>
                                    <td>Apps per Deal:</td>
                                    <td>@Model.AppsPerDeal</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th> </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Units Sold:</td>
                                    <td>@Model.UnitsSold</td>
                                </tr>
                                <tr>
                                    <td>Total Projected:</td>
                                    <td>@Model.ProjectedTotal</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-3">
        <div class="data-panel">
            <h3 class="mb-3 text-center">New Car</h3>
            <hr />
            <div class="row">
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th> </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>New Apps:</td>
                                    <td>@Model.NewCarsApps</td>
                                </tr>
                                <tr>
                                    <td>Validated:</td>
                                    <td>@Model.NewCarsValidated</td>
                                </tr>
                                <tr>
                                    <td>Taken Up New:</td>
                                    <td>@Model.NewCarsTakenUp</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th> </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>SOLD:</td>
                                    <td>@Model.NewCarsTakenUp</td>
                                </tr>
                                <tr>
                                    <td>Validated NTU:</td>
                                    <td>@Model.NewCarsNTU</td>
                                </tr>
                                <tr>
                                    <td>Apps per Deal:</td>
                                    <td>@Model.NewCarsAppsPerDeal</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>

    <div class="col-xl-3">
        <div class="data-panel">
            <h3 class="mb-3 text-center">Used Car</h3>
            <hr />
            <div class="row">
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th> </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Used Apps:</td>
                                    <td>@Model.UsedCarsApps</td>
                                </tr>
                                <tr>
                                    <td>Demo Apps:</td>
                                    <td>@Model.UsedCarsDemoApps</td>
                                </tr>
                                <tr>
                                    <td>Validated:</td>
                                    <td>@Model.UsedCarsValidated</td>
                                </tr>
                                <tr>
                                    <td>Taken Up Used:</td>
                                    <td>@Model.UsedCarsTakenUp</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th> </th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>SOLD:</td>
                                    <td>@Model.UsedCarsTakenUp</td>
                                </tr>
                                <tr>
                                    <td>Validated NTU:</td>
                                    <td>@Model.UsedCarsNTU</td>
                                </tr>
                                <tr>
                                    <td>Apps per Deal:</td>
                                    <td>@Model.UsedCarsAppsPerDeal</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>
<!-- END ROW 1 -->
<!-- BEGIN row 2 -->
<div class="row">
    <div class="col-xl-6">
        <div class="data-panel-300">
            <h3 class="mb-3 text-center">Applications Statistics</h3>
            <hr />
            <div class="row">
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th>Count</th>
                                    <th>App Ratio</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Approved:</td>
                                    <td>@Model.ApprovedTotal</td>
                                    <td>@Model.ApprovedRatio%</td>
                                </tr>
                                <tr>
                                    <td>Declined:</td>
                                    <td>@Model.DeclinedTotal</td>
                                    <td>@Model.DeclinedRatio%</td>
                                </tr>
                                <tr>
                                    <td>Self Financed:</td>
                                    <td>@Model.SelfFinanceTotal</td>
                                    <td>@Model.SelfFinanceRatio%</td>
                                </tr>
                                <tr>
                                    <td>Cash:</td>
                                    <td>@Model.CashTotal</td>
                                    <td>@Model.CashRatio%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th>Count</th>
                                    <th>App Ratio</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Validated:</td>
                                    <td>@Model.ValidatedApps</td>
                                    <td>@Model.ValidatedAppsRatio%</td>
                                </tr>
                                <tr>
                                    <td>Total Apps:</td>
                                    <td>@Model.TotalApps2</td> <!-- might needs to change -->
                                    <td></td>
                                </tr>
                                <tr>
                                    <td>Taken Up:</td>
                                    <td>@Model.AppsTakenUp</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-6">
        <div class="data-panel-300">
            <h3 class="mb-3 text-center">NTU's</h3>
            <hr />
            <div class="row">
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th>Count</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Total Sold:</td>
                                    <td>@Model.TotalSold</td> 
                                </tr>
                                <tr>
                                    <td>Total NTU:</td>
                                    <td>@Model.TotalNTU</td>
                                </tr>
                                <tr>
                                    <td>Total Spotter Deal:</td>
                                    <td>@Model.TotalSpotterDeals</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
                <div class="col-6">
                    <div class="overflow-container">
                        <table class="table table-borderless table-hover">
                            <thead>
                                <tr>
                                    <th> </th>
                                    <th>Count</th>
                                    <th>Ratio</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td>Validated Spotter Deals:</td>
                                    <td>@Model.ValidatedSpotterDeals</td>
                                    <td> </td>
                                </tr>
                                <tr>
                                    <td>Spotter Deal NTU:</td>
                                    <td>@Model.SpotterDealsNTU</td>
                                    <td>@Model.SpotterDealsNTURatio%</td>
                                </tr>
                                <tr>
                                    <td>NTU Ratio:</td>
                                    <td>@Model.NTURatio%</td>
                                    <td></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END ROW 2 -->
<!-- BEGIN row 2 -->
<script>
	var handleRenderApexChart = function () {
		Apex = {
			title: {
				style: {
					fontSize: '14px',
					fontWeight: '600',
					fontFamily: app.font.bodyFontFamily,
					color: app.color.bodyColor
				}
			},
			legend: {
				fontFamily: app.font.bodyFontFamily,
				labels: { colors: app.color.bodyColor }
			},
			tooltip: {
				style: {
					fontSize: '12px',
					fontFamily: app.font.bodyFontFamily
				}
			},
			grid: { borderColor: app.color.borderColor },
			dataLabels: {
				style: {
					fontSize: '12px',
					fontFamily: app.font.bodyFontFamily,
					fontWeight: '600',
					colors: undefined
				}
			},
			xaxis: {
				axisBorder: {
					show: true,
					color: app.color.borderColor,
					height: 1,
					width: '100%',
					offsetX: 0,
					offsetY: -1
				},
				axisTicks: {
					show: true,
					borderType: 'solid',
					color: app.color.borderColor,
					height: 6,
					offsetX: 0,
					offsetY: 0
				},
				labels: {
					style: {
						colors: app.color.bodyColor,
						fontSize: '12px',
						fontFamily: app.font.bodyFontFamily,
						fontWeight: app.font.bodyFontWeight,
						cssClass: 'apexcharts-xaxis-label',
					}
				}
			},
			yaxis: {
				labels: {
					style: {
						colors: app.color.bodyColor,
						fontSize: '12px',
						fontFamily: app.font.bodyFontFamily,
						fontWeight: app.font.bodyFontWeight,
						cssClass: 'apexcharts-xaxis-label',
					}
				}
			}
		};

		// apexColumnChart
		var apexColumnChartOptions = {
			chart: {
				height: 350,
				type: 'bar'
			},
			title: {
				text: 'Profit & Margin Chart',
				align: 'center'
			},
			plotOptions: {
				bar: {
					horizontal: false,
					columnWidth: '55%',
					endingShape: 'rounded'
				},
			},
			dataLabels: { enabled: false },
			stroke: {
				show: true,
				width: 2,
				colors: ['transparent']
			},
			colors: [app.color.theme, app.color.indigo, app.color.inverse],

			series: [
				/*{ name: 'Daily Used Car Apps', data: dailyUsedData },*/
				{ name: 'Daily New Car Apps', data: dailyNewData },
                { name: 'Daily Used Car Apps', data: dailyUsedData },
				{ name: 'Daily Demo Car Apps', data: dailyDemoData },
				{ name: 'Daily Not Take Up', data: dailyNtuData, color: '#ff6666' }
			],
			xaxis: {
				type: 'datetime',
				categories: categories,
				labels: {
					datetimeUTC: false, // Set to true if your data is in UTC
				}
			},
			yaxis: {
				title: {
					text: 'Total Apps',
					style: {
						color: 'rgba(' + app.color.bodyColorRgb + ', .5)',
						fontSize: '12px',
						fontFamily: app.font.bodyFontFamily,
						fontWeight: app.font.bodyFontWeight
					}
				}
			},
			fill: { opacity: 1 },
			tooltip: {
				y: {
					formatter: function (val) {
						return "Total Apps: " + val;
					}
				}
			}
		};

		var apexColumnChart = new ApexCharts(
			document.querySelector('#apexColumnChart'),
			apexColumnChartOptions
		);
		apexColumnChart.render();

		// apexAreaChart
		var apexAreaChartOptions = {
			chart: {
				height: 350,
				type: 'area',
			},
			dataLabels: { enabled: false },
			stroke: { curve: 'smooth', width: 3 },
			colors: [app.color.teal, app.color.inverse],
			series: [
				{ name: 'Approved', data: dailyApprovedData },
				{ name: 'Declined', data: dailyDeclinedData, color: '#ff6666' },
				//{ name: 'Self Finance', data: dailySelfFinancedData, color: '#FFFF00' },
				//{ name: 'Cash', data: dailyCashData, color: '#00FF00' }
			],
			xaxis: {
				type: 'datetime',
				categories: categories,
				axisBorder: {
					show: true,
					color: app.color.borderColor,
					height: 1,
					width: '100%',
					offsetX: 0,
					offsetY: -1
				},
				axisTicks: {
					show: true,
					borderType: 'solid',
					color: app.color.borderColor,
					height: 6,
					offsetX: 0,
					offsetY: 0
				},
				labels: {
					datetimeUTC: false, // Set to true if your data is in UTC
				}
			},
			tooltip: { x: { format: 'dd/MM/yy HH:mm', date: categories } }
		};
		var apexAreaChart = new ApexCharts(
			document.querySelector('#apexAreaChart'),
			apexAreaChartOptions
		);
		apexAreaChart.render();

		// apexRadialBarChartUsed
		var apexRadialBarChartOptionsUsedApps = {
			chart: {
				height: 350,
				type: 'radialBar'
			},
			plotOptions: {
				radialBar: {
					offsetY: 0,
					startAngle: 0,
					endAngle: 270,
					hollow: {
						margin: 5,
						size: '30%',
						background: 'transparent',
						image: undefined,
					},
					track: { background: app.color.borderColor },
					dataLabels: {
						name: { show: false },
						value: { show: false }
					}
				}
			},
			colors: [app.color.cyan, app.color.theme, app.color.indigo, app.color.gray300],
			series: [totalUsedCarAppsData, totalDemoCarAppsData, totalUsedCarValidatedData, totalUsedCarSoldData, totalUsedCarSoldData, totalUsedCarNtuData, totalUsedCarAppsPerDealData],
			labels: ['Used Apps', 'Demo Apps', 'Validated', 'Taken Up', 'Sold', 'Validated NTU', 'Apps Per Deal'],
			legend: {
				show: true,
				floating: true,
				position: 'left',
				labels: { useSeriesColors: true },
				markers: { size: 0 },
				formatter: function (seriesName, opts) {
					return seriesName + ":  " + opts.w.globals.series[opts.seriesIndex]
				},
				itemMargin: { horizontal: 1 }
			}
		}
		var apexRadialBarChartUsedApps = new ApexCharts(
			document.querySelector('#apexRadialBarChartUsedApps'),
			apexRadialBarChartOptionsUsedApps
		);
		apexRadialBarChartUsedApps.render();
	};


	/* Controller
	------------------------------------------------ */
	$(document).ready(function () {
		handleRenderApexChart();

		$(document).on('theme-reload', function () {
			$('#apexLineChart, #apexColumnChart, #apexAreaChart, #apexBarChart, #apexMixedChart, #apexCandlestickChart, #apexBubbleChart, #apexScatterChart, #apexHeatmapChart, #apexPieChart, #apexRadialBarChartNewApps, #apexRadarChart').empty();

			handleRenderApexChart();
		});
	});
</script>

<div class="row">
    <div class="col-xl-6">
        <div class="data-panel-300">
            <h3 class="mb-3 text-center">Daily Applications Statistics</h3>
            <hr />
            <div class="row">
                <div class="col-12">
                    <div class="">
                        <div id="apexColumnChart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="col-xl-6">
        <div class="data-panel-300">
            <h3 class="mb-3 text-center">Approvals / Declines</h3>
            <hr />
            <div class="row">
                <div class="col-12">
                    <div class="">
                        <div id="apexAreaChart"></div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>
<!-- END ROW 2 -->
